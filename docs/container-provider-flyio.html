<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Containers/container-provider-flyio" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">fly.io | Metapages</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.metapage.io/docs/container-provider-flyio"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="metapages, javascript, code, workflow, app, evolution, superslides, gestures, hand control, deep time"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="fly.io | Metapages"><meta data-rh="true" name="description" content="f71aa082c32c49d1a43a8add8fbca628}"><meta data-rh="true" property="og:description" content="f71aa082c32c49d1a43a8add8fbca628}"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.metapage.io/docs/container-provider-flyio"><link data-rh="true" rel="alternate" href="https://docs.metapage.io/docs/container-provider-flyio" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.metapage.io/docs/container-provider-flyio" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Metapages RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Metapages Atom Feed">







<link rel="search" type="application/opensearchdescription+xml" title="Metapages" href="/opensearch.xml">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&amp;display=swap"><link rel="stylesheet" href="/assets/css/styles.2a01014e.css">
<script src="/assets/js/runtime~main.21b39088.js" defer="defer"></script>
<script src="/assets/js/main.3c677dbb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Metapages Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Metapages Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/metapages/docs.metapage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/container-provider-flyio" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://metapage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><a href="https://metapage.io/sign-up" style="background-color: var(--color-cta-primary-background); color: var(--color-cta-primary-foreground); font-weight: var(--font-cta-primary-weight); position: relative; outline: none; border-radius: 6px; display: flex; justify-content: center; align-items: center; cursor: pointer; padding: 5px 30px;">Sign Up</a></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/getting-started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/connect-inputs-outputs">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/examples">Examples</a><button aria-label="Expand sidebar category &#x27;Examples&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/containers">Containers</a><button aria-label="Collapse sidebar category &#x27;Containers&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/container-remote-mode">remote</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/container-local-mode">local</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/container-provider-flyio">fly.io</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/container-cli-reference">worker cli reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/git-refs-in-urls">github refs in URLs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/error-missing-git-sha">Errors</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/npm-modules">Libraries, Tools, APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/18201857-9bb5-80a5-8421-e79cfe8d56ab">Help</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/llm-summary">LLM summary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/containers"><span itemprop="name">Containers</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">fly.io</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deployment on Fly.io</h1></header>
<p><a href="http://fly.io/" target="_blank" rel="noopener noreferrer">Fly.io</a> is an accessible, straightforward cloud platform where you can deploy and manage full-stack VMs with the convenience of containers. Metapage workers can be deployed on Fly by defining and launching a couple of Fly apps.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="f58f1df8856f4eeebe706cccae23e8cc">Prerequisites<a href="#f58f1df8856f4eeebe706cccae23e8cc" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<ul>
<li>A <a href="http://fly.io/" target="_blank" rel="noopener noreferrer">Fly.io</a> account, of course</li>
<li>The <a href="https://fly.io/docs/flyctl/install/" target="_blank" rel="noopener noreferrer">flyctl</a> command line utility</li>
<li>A random queue ID that the Metapage workers use to listen and receive jobs. This queue ID will need to be provided to both the deployed workers and the metaframe you want them processing jobs for.<!-- -->
<ul>
<li>If you’re on MacOS or Linux, you should be able to generate a UUID with the <code>uuid</code> command, and this suits the case perfectly.</li>
</ul>
</li>
</ul>
<p>Deploy the worker app</p>
<p>Fly apps are usually defined with a TOML configuration file. Copy the following Fly TOML config to a file named <code>workers-a.fly.toml</code>. Replace <code>MyOrg</code> with a unique name to prefix your app with — your actual Fly Organization name is a good choice for this. If you’re just using a personal account, this is probably your username. Run <code>fly orgs list</code> to show your orgs.</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># See https://fly.io/docs/reference/configuration/ for information about how to use this file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app = &#x27;MyOrg-metapage-workers-a&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">primary_region = &#x27;ord&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[build]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image = &#x27;metapage/metaframe-docker-worker:latest-standalone&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This example uses 2CPU/4GB RAM machines with an attached L40S GPU. These can</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># get pricey, so make sure it&#x27;s not sticking around when you don&#x27;t need it!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (Check the section on autoscaling below for more)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[[vm]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  memory = &#x27;4gb&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu_kind = &#x27;performance&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpus = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  size = &#x27;l40s&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[env]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  METAPAGE_IO_CPUS = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  METAPAGE_IO_GPUS = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  METAPAGE_IO_WORKER_RUN_STANDALONE = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[[restart]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  policy = &quot;on-failure&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retries = 10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7733defd882c43879c1aca35bd0f9fad">Hey, what is this TOML file doing?<a href="#7733defd882c43879c1aca35bd0f9fad" class="hash-link" aria-label="Direct link to Hey, what is this TOML file doing?" title="Direct link to Hey, what is this TOML file doing?">​</a></h3>
<p>If you prefer to sink your teeth deep into the fly app configuration features immediately, you can check out the <a href="https://fly.io/docs/reference/configuration/" target="_blank" rel="noopener noreferrer">full fly.toml app configuration doc</a>. Otherwise, let’s step through the above file’s contents to explain what each section is doing.</p>
<p>The <code>primary_region</code> defines what geographical region machines will be created in by default. <code>ord</code> is the code for Chicago, Illinois, chosen here because it’s the only region with L40S GPUs available at time of writing. If you want to change this, you can run <code>fly platform regions</code> or check the <a href="https://fly.io/docs/reference/regions/" target="_blank" rel="noopener noreferrer">Regions documentation</a> to see the extensive list of possible regions to run your workers.</p>
<p>This just tells Fly that we want to use the latest “standalone” version of the metapage worker image from Docker Hub. The standalone image provides its own container daemon rather than relying on the host to provide one.</p>
<p>This section defines some of the compute capabilities we’re reserving. In this case, 2 dedicated CPU cores, 4GB of RAM, and an Nvidia L40S GPU attached. You can get a look at what CPU/RAM/GPU options are available on Fly’s <a href="https://fly.io/docs/about/pricing/" target="_blank" rel="noopener noreferrer">pricing page</a>, and see the <a href="https://fly.io/docs/reference/configuration/#the-vm-section" target="_blank" rel="noopener noreferrer">VM section</a> of the configuration docs for the keywords to configure the machines to your liking.</p>
<p><code>METAPAGE_IO_GPUS</code> does ditto for GPUs. We have 1, so we set this to <code>1</code>.</p>
<p><code>METAPAGE_IO_WORKER_RUN_STANDALONE</code> is an option made available for environments that don’t provide a running docker daemon for the metapage worker. The non-standalone version of the worker expects such a daemon to be accessible, but this option tells the worker to provide <em>its own</em> container runtime instead.</p>
<p>This tells fly that if our worker exits normally, we can leave it <code>stopped</code> , but if it crashes, we should restart it. It will try to restart 10 times before giving up if issues persist.</p>
<p>We’ll stage a secret for the app before we deploy its full configuration, so first create an empty app:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly apps create MyOrg-metapage-workers-a </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(don’t forget to replace MyOrg with your unique prefix)</p>
<p>Then set a secret on the app, using the metapage queue ID specified in the <a href="/docs/container-provider-flyio#f58f1df8856f4eeebe706cccae23e8cc">Prerequisites</a>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly secrets </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> MyOrg-metapage-workers-a </span><span class="token assign-left variable" style="color:#36acaa">METAPAGE_IO_QUEUE</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MyGeneratedQueueId</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We’re ready to deploy the worker! Run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly deploy </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> workers-a.fly.toml </span><span class="token parameter variable" style="color:#36acaa">--yes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--ha</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will deploy the new app with the file’s definition, accept all the usual prompts, and prevent deploying in High Availability mode (in other words, it will create 1 VM instead of 2).</p>
<p>Once it finishes, you should be able to see your app in the Fly dashboard. Take a peek:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/container-provider-flyio.623d441c-0612-463a-9c9a-b5dd38ece30b-9c5453cfc55e2849711cfed8958d52b6.png" width="1872" height="1354" class="img_ev3q"></p>
<p>It looks like the worker is deployed and running, but check out the logs (under <code>Live Logs</code>) to make sure it’s successfully connected to its queue.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/container-provider-flyio.fff06d99-53d9-4513-9254-dbf21d9332bb-9debef247486fcf5a66ba575e41d49cc.png" width="1864" height="1027" class="img_ev3q"></p>
<p>You can also follow the app logs from the command line at any time with <code>fly logs -a MyOrg-metapage-workers-a</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="e483fac6e3864e15ad1eb91a094feb75">Scale the workers<a href="#e483fac6e3864e15ad1eb91a094feb75" class="hash-link" aria-label="Direct link to Scale the workers" title="Direct link to Scale the workers">​</a></h2>
<p>Adjusting the number of worker machines by hand is easy. If you want 2 workers, just run <code>fly scale count 2 -a MyOrg-metapage-workers-a</code>. The same works for 4, 10, or 0.</p>
<p>You can look at the machines you just created either in the web UI or with <code>fly machines list -a MyOrg-metapage-workers-a</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8e81556971984e71ac4568c5aec1dc5d"><em>Auto</em>-scale the workers<a href="#8e81556971984e71ac4568c5aec1dc5d" class="hash-link" aria-label="Direct link to 8e81556971984e71ac4568c5aec1dc5d" title="Direct link to 8e81556971984e71ac4568c5aec1dc5d">​</a></h2>
<p>You might want a lot of workers, but you don’t want to play with the numbers by hand. It’s error-prone, and forgotten machines can run up a bill. We can auto-scale instead (including scale-to-zero) by deploying a couple other small apps.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="06965f4f4d3c42e898c64c1c17bd03f6">Metrics proxy<a href="#06965f4f4d3c42e898c64c1c17bd03f6" class="hash-link" aria-label="Direct link to Metrics proxy" title="Direct link to Metrics proxy">​</a></h3>
<p><a href="https://github.com/miend/fly-metrics-proxy" target="_blank" rel="noopener noreferrer">Fly Metrics Proxy</a> is a simple service for forwarding Prometheus-compatible metrics to Fly.io’s managed Prometheus service. It listens for requests to its <code>/metrics</code> endpoint, and then in turn fetches a number of other metrics from external endpoints we define, aggregates them, attaches additional labels, and sends them all back to Fly. This will let us provide Fly with metrics about our job queue(s) from Metapage’s API to determine whether we should spin more workers up or down.</p>
<p>You’ll need that Queue ID handy which you generated earlier for the original worker deployment. Then, copy the below config to a file named <code>metrics-proxy.toml</code>, replacing <code>MyOrg</code> with your org name:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">app = &#x27;MyOrg-metrics-proxy&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">primary_region = &#x27;ord&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[build]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	# TODO: If we can host/mirror this in metapage&#x27;s docker, replace below line!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image = &#x27;docker.io/michaelendsley/fly-metrics-proxy:latest&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[env]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  METRICS_TARGETS = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;endpoint&quot;: &quot;https://container.mtfm.io/MyGeneratedQueueID/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;app_name&quot;: &quot;MyOrg-metapage-workers-a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[[vm]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  memory = &#x27;256mb&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu_kind = &#x27;shared&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpus = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[metrics]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port = 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path = &#x27;/metrics&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  https = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This app will listen for requests to <code>/metrics</code> from Fly, and will in turn reach out to the Metapage public API for your job queue’s metrics (we provide a single metric of <code>queue_length</code>), attach a label “app_name” to it, and return it to Fly in its response.</p>
<p>You don’t need to do any special setup for this app. Just use this command to get it running:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly launch </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> metrics-proxy.toml --copy-config </span><span class="token parameter variable" style="color:#36acaa">--yes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--ha</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you want to confirm that it’s doing what it should (beyond looking at the app logs), the <a href="http://fly.io/" target="_blank" rel="noopener noreferrer">Fly.io</a> dashboard has a <code>Metrics</code> section that takes you to a provided Grafana dashboard. You can explore metrics there to find your <code>queue_length</code> metric, with a label <code>app_name</code> equal to your Fly worker app’s name.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="08f9793fd7704349917da275cbdb278d">Autoscaler<a href="#08f9793fd7704349917da275cbdb278d" class="hash-link" aria-label="Direct link to Autoscaler" title="Direct link to Autoscaler">​</a></h3>
<p>Next, we’ll use <a href="https://github.com/superfly/fly-autoscaler" target="_blank" rel="noopener noreferrer">Fly Autoscaler</a> which can leverage the metrics we just provided to scale the worker app. Actually, it can scale more than 1 set of workers, but more on that below.</p>
<p>Copy the below config to a file named <code>autoscaler.fly.toml</code>:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">app = &quot;MyOrg-metapage-autoscaler&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[build]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image = &quot;flyio/fly-autoscaler:0.3.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[env]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FAS_APP_NAME = &quot;MyOrg-metapage-workers-a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FAS_STARTED_MACHINE_COUNT = &quot;ceil(queue_length / 1)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FAS_PROMETHEUS_ADDRESS = &quot;https://api.fly.io/prometheus/MyOrg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FAS_PROMETHEUS_METRIC_NAME = &quot;queue_length&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FAS_PROMETHEUS_QUERY = &quot;sum(queue_length{app=&#x27;$APP_NAME&#x27;})&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[metrics]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port = 9090</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;/metrics&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Don’t forget to replace instances of <code>MyOrg</code> with your org name!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="187cba7f2fac4431ad7d602eb0439522">Alright, what is <em>this</em> TOML file doing?<a href="#187cba7f2fac4431ad7d602eb0439522" class="hash-link" aria-label="Direct link to 187cba7f2fac4431ad7d602eb0439522" title="Direct link to 187cba7f2fac4431ad7d602eb0439522">​</a></h3>
<p>Ignoring the parts already explained before in the <code>workers-a.fly.toml</code>, this just defines a few Fly Autoscaler-specific environment variables.</p>
<p><code>FAS_APP_NAME</code> sets the name of the app(s) targeted for autoscaling. This supports wildcard matches, but right now we’re looking for the exact name of our worker app.</p>
<p><code>FAS_STARTED_MACHINE_COUNT</code> is an <a href="https://expr-lang.org/docs/language-definition" target="_blank" rel="noopener noreferrer">Expr</a> language expression defining how many machines in our app’s current pool of machines should be in a <em>started</em> state. These are the ones for which you’ll be charged CPU/GPU &amp; RAM by Fly, as long as they’re running. This expression says that our machine count should be the same number of jobs in the queue. If we assumed each worker could handle 2 jobs from the queue instead of 1, it could become <code>ceil(queue_length / 2)</code>. If we wanted one worker always online, it could be <code>ceil(queue_length / 2) + 1</code>, and so on.</p>
<p><code>FAS_PROMETHEUS_ADDRESS</code> , <code>FAS_PROMETHEUS_METRIC_NAME</code> , and <code>FAS_PROMETHEUS_QUERY</code> all relate to the query the autoscaler is making from the Fly-managed Prometheus instance provided for each org. <code>queue_length</code> is the metric provided by the metapage worker representing queue jobs not in a <code>Finished</code> state.</p>
<p>Just as we did with the worker app, we’ll create an empty app for the autoscaler first, then set a couple of secrets before we deploy it.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly apps create MyOrg-metapage-autoscaler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create a deploy token for your worker app, which will give Fly Autoscaler permission to perform scaling operations on it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly tokens create deploy </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> MyOrg-metapage-workers-a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Set the value of this as a secret on the autoscaler:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly secrets </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> MyOrg-metapage-autoscaler </span><span class="token assign-left variable" style="color:#36acaa">FAS_API_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;[deploy token value]&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create a read-only token that will let the autoscaler read from your org’s managed Prometheus endpoint:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly tokens create </span><span class="token builtin class-name">readonly</span><span class="token plain"> MyOrg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And set this as a secret, too:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly secrets </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> my-autoscaler </span><span class="token assign-left variable" style="color:#36acaa">FAS_PROMETHEUS_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;[readonly token value]&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, deploy the autoscaler:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly deploy </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> autoscaler.fly.toml </span><span class="token parameter variable" style="color:#36acaa">--ha</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The option <code>--ha=false</code> prevents the autoscaler from launching with more than 1 machine in its app.</p>
<p>At this point, the autoscaler should spin up and start evaluating the <code>queue_depth</code> metric and determining if it needs to start or stop any worker machines in your deployed app. The limit on the number of machines that can be started is simply the scale of your app. If you currently have just 1 machine running in your worker app, try running <code>fly scale count 5 -a MyOrg-metapage-workers-a</code>.</p>
<p>If you have no active jobs in the queue, you should see a number of machines spin up at first, and then the autoscaler will begin stopping them as part of its reconciliation loop. In short order you’ll be left with 5 <code>Stopped</code> machines.</p>
<p>If 5 or more unfinished jobs stick around the metapage queue for your workers, then you should see the number of <code>Running</code> machines automatically scale up to the limit (5), and drop again once enough jobs are processed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="c430c95b5c2f494a9419b399f7d11dd5">Deploy and scale workers on multiple queues<a href="#c430c95b5c2f494a9419b399f7d11dd5" class="hash-link" aria-label="Direct link to Deploy and scale workers on multiple queues" title="Direct link to Deploy and scale workers on multiple queues">​</a></h2>
<p>If you want to process jobs on multiple queues, you’ll need multiple worker apps to match. You can, for example, <code>cp workers-a.fly.toml workers-b.fly.toml</code> and modify the contents to end up with something like this:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># See https://fly.io/docs/reference/configuration/ for information about how to use this file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app = &#x27;MyOrg-metapage-workers-b&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">primary_region = &#x27;ord&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[build]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image = &#x27;metapage/metaframe-docker-worker:latest-standalone&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[[vm]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  memory = &#x27;2gb&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu_kind = &#x27;shared&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpus = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[env]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  METAPAGE_IO_CPUS = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  METAPAGE_IO_WORKER_RUN_STANDALONE = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...redundant parts snipped...]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Deploy this one just like before, by first creating the empty app and setting its <code>METAPAGE_IO_QUEUE</code> as a secret, and then using <code>fly deploy [...]</code> . You should now have two worker groups running.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5da3c3cc3cac495caca1b77d126e1d36">Update the metrics proxy<a href="#5da3c3cc3cac495caca1b77d126e1d36" class="hash-link" aria-label="Direct link to Update the metrics proxy" title="Direct link to Update the metrics proxy">​</a></h3>
<p>Your metrics proxy should be requesting metrics for your first job queue, but now that you’re adding a second set of workers, you’ll want to update it so it fetches the metrics for that too. In <code>metrics-proxy.toml</code>, change the environment variable <code>METRICS_TARGETS</code> like so:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[env]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  METRICS_TARGETS = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;endpoint&quot;: &quot;https://container.mtfm.io/MyGeneratedQueueID/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;app_name&quot;: &quot;MyOrg-metapage-workers-a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	  &quot;endpoint&quot;: &quot;https://container.mtfm.io/MySecondQueueID/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	  &quot;app_name&quot;: &quot;MyOrg-metapage-workers-b&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Deploy with a <code>fly deploy -c metrics-proxy.toml --ha=false</code>, and the metrics proxy will begin forwarding metrics for both of your queues.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5885df5be6e64e49a34952cba12ec5c4">Update the autoscaler<a href="#5885df5be6e64e49a34952cba12ec5c4" class="hash-link" aria-label="Direct link to Update the autoscaler" title="Direct link to Update the autoscaler">​</a></h3>
<p>If you stuck with the naming scheme presented in this doc, adding this new worker app to the autoscaler config is straightforward as well. You’ll only need two changes to your <code>autoscaler.fly.toml</code> , both of them under the <code>[env]</code> section:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[env]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FAS_APP_NAME = &quot;MyOrg-metapage-workers-*&quot; # this one is changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FAS_ORG = &quot;MyOrg&quot; # this one is new</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>FAS_APP_NAME</code> is defined here with a wildcard. The autoscaler will look for any apps matching that wildcard pattern (in this case both <code>a</code> and <code>b</code>), and assume it should be scaling both of them.</p>
<p>Since it’s now targeting multiple apps in the org instead of just one, you’ll also need to switch its <code>FAS_API_TOKEN</code> to one with privileges across the org. Create the token:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly tokens create org</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then set it on the autoscaler app:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly secrets </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> MyOrg-metapage-autoscaler </span><span class="token assign-left variable" style="color:#36acaa">FAS_API_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;[org token value]&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Redeploy the autoscaler:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly deploy </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> autoscaler.fly.toml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The autoscaler will process the <code>queue_length</code> metric queries for each app and reconcile their started machine counts separately.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="20f4f803bb2849819c9cf0e958f71841">Undeploy the Apps<a href="#20f4f803bb2849819c9cf0e958f71841" class="hash-link" aria-label="Direct link to Undeploy the Apps" title="Direct link to Undeploy the Apps">​</a></h2>
<p>Getting rid of any of the deployed applications is as simple as:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fly apps destroy </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">appname</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will delete the app and <em>all resources</em> associated with it.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/container-local-mode"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">local</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/container-cli-reference"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">worker cli reference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#f58f1df8856f4eeebe706cccae23e8cc" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#7733defd882c43879c1aca35bd0f9fad" class="table-of-contents__link toc-highlight">Hey, what is this TOML file doing?</a></li></ul></li><li><a href="#e483fac6e3864e15ad1eb91a094feb75" class="table-of-contents__link toc-highlight">Scale the workers</a></li><li><a href="#8e81556971984e71ac4568c5aec1dc5d" class="table-of-contents__link toc-highlight"><em>Auto</em>-scale the workers</a><ul><li><a href="#06965f4f4d3c42e898c64c1c17bd03f6" class="table-of-contents__link toc-highlight">Metrics proxy</a></li><li><a href="#08f9793fd7704349917da275cbdb278d" class="table-of-contents__link toc-highlight">Autoscaler</a></li><li><a href="#187cba7f2fac4431ad7d602eb0439522" class="table-of-contents__link toc-highlight">Alright, what is <em>this</em> TOML file doing?</a></li></ul></li><li><a href="#c430c95b5c2f494a9419b399f7d11dd5" class="table-of-contents__link toc-highlight">Deploy and scale workers on multiple queues</a><ul><li><a href="#5da3c3cc3cac495caca1b77d126e1d36" class="table-of-contents__link toc-highlight">Update the metrics proxy</a></li><li><a href="#5885df5be6e64e49a34952cba12ec5c4" class="table-of-contents__link toc-highlight">Update the autoscaler</a></li></ul></li><li><a href="#20f4f803bb2849819c9cf0e958f71841" class="table-of-contents__link toc-highlight">Undeploy the Apps</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Live Examples</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://metapage.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gallery<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://bsky.app/profile/metapages.bsky.social" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://substack.metapage.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Substack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/orgs/metapages/projects/1" target="_blank" rel="noopener noreferrer" class="footer__link-item">Public Roadmap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/terms-of-service">Terms of Service</a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/data-deletion">Data Deletion</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/ATvFWMGKVZ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/metapages/docs.metapage.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 metapages, LLC. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>